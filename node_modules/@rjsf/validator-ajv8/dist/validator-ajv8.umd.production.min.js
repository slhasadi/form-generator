!function(r,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("lodash-es/toPath"),require("lodash-es/isObject"),require("lodash-es/clone"),require("@rjsf/utils"),require("ajv8"),require("ajv-formats")):"function"==typeof define&&define.amd?define(["exports","lodash-es/toPath","lodash-es/isObject","lodash-es/clone","@rjsf/utils","ajv8","ajv-formats"],e):e((r="undefined"!=typeof globalThis?globalThis:r||self)["@rjsf/validator-ajv8"]={},r.toPath,r.isObject,r.clone,r.utils,r.Ajv,r.addFormats)}(this,(function(r,e,t,a,o,s,i){"use strict";function n(r){return r&&"object"==typeof r&&"default"in r?r:{default:r}}var d=n(e),c=n(t),l=n(a),h=n(s),u=n(i);const f={allErrors:!0,multipleOfPrecision:8,strict:!1},m=/^(#?([0-9A-Fa-f]{3}){1,2}\b|aqua|black|blue|fuchsia|gray|green|lime|maroon|navy|olive|orange|purple|red|silver|teal|white|yellow|(rgb\(\s*\b([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\b\s*,\s*\b([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\b\s*,\s*\b([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\b\s*\))|(rgb\(\s*(\d?\d%|100%)+\s*,\s*(\d?\d%|100%)+\s*,\s*(\d?\d%|100%)+\s*\)))$/,v=/^data:([a-z]+\/[a-z0-9-+.]+)?;(?:name=(.*);)?base64,(.*)$/,p="__rjsf_rootSchema";class y{constructor(r,e){this.ajv=void 0,this.localizer=void 0;const{additionalMetaSchemas:t,customFormats:a,ajvOptionsOverrides:s,ajvFormatOptions:i,AjvClass:n}=r;this.ajv=function(r,e,t,a,s){void 0===t&&(t={}),void 0===s&&(s=h.default);const i=new s({...f,...t});return a?u.default(i,a):!1!==a&&u.default(i),i.addFormat("data-url",v),i.addFormat("color",m),i.addKeyword(o.ADDITIONAL_PROPERTY_FLAG),i.addKeyword(o.RJSF_ADDITONAL_PROPERTIES_FLAG),Array.isArray(r)&&i.addMetaSchema(r),c.default(e)&&Object.keys(e).forEach((r=>{i.addFormat(r,e[r])})),i}(t,a,s,i,n),this.localizer=e}toErrorSchema(r){return r.length?r.reduce(((r,e)=>{const{property:t,message:a}=e,o=d.default(t);let s=r;o.length>0&&""===o[0]&&o.splice(0,1);for(const r of o.slice(0))r in s||(s[r]={}),s=s[r];return Array.isArray(s.__errors)?s.__errors=s.__errors.concat(a):a&&(s.__errors=[a]),r}),{}):{}}toErrorList(r,e){if(void 0===e&&(e=[]),!r)return[];let t=[];return o.ERRORS_KEY in r&&(t=t.concat(r.__errors.map((r=>{const t=`.${e.join(".")}`;return{property:t,message:r,stack:`${t} ${r}`}})))),Object.keys(r).reduce(((t,a)=>(a!==o.ERRORS_KEY&&(t=t.concat(this.toErrorList(r[a],[...e,a]))),t)),t)}createErrorHandler(r){const e={__errors:[],addError(r){this.__errors.push(r)}};if(Array.isArray(r))return r.reduce(((r,e,t)=>({...r,[t]:this.createErrorHandler(e)})),e);if(c.default(r)){const t=r;return Object.keys(t).reduce(((r,e)=>({...r,[e]:this.createErrorHandler(t[e])})),e)}return e}unwrapErrorHandler(r){return Object.keys(r).reduce(((e,t)=>"addError"===t?e:t===o.ERRORS_KEY?{...e,[t]:r[t]}:{...e,[t]:this.unwrapErrorHandler(r[t])}),{})}transformRJSFValidationErrors(r){return void 0===r&&(r=[]),r.map((r=>{const{instancePath:e,keyword:t,message:a,params:o,schemaPath:s}=r,i=e.replace(/\//g,".");return{name:t,property:i,message:a,params:o,stack:`${i} ${a}`.trim(),schemaPath:s}}))}rawValidation(r,e){let t,a,o;r.$id&&(a=this.ajv.getSchema(r.$id));try{void 0===a&&(a=this.ajv.compile(r)),a(e)}catch(r){t=r}return a&&("function"==typeof this.localizer&&this.localizer(a.errors),o=a.errors||void 0,a.errors=null),{errors:o,validationError:t}}validateFormData(r,e,t,a){const s=this.rawValidation(e,r),{validationError:i}=s;let n=this.transformRJSFValidationErrors(s.errors);i&&(n=[...n,{stack:i.message}]),"function"==typeof a&&(n=a(n));let d=this.toErrorSchema(n);if(i&&(d={...d,$schema:{__errors:[i.message]}}),"function"!=typeof t)return{errors:n,errorSchema:d};const c=o.getDefaultFormState(this,e,r,e,!0),l=t(c,this.createErrorHandler(c)),h=this.unwrapErrorHandler(l);return o.mergeValidationData(this,{errors:n,errorSchema:d},h)}withIdRefPrefixObject(r){for(const e in r){const t=r[e];r[e]=e===o.REF_KEY&&"string"==typeof t&&t.startsWith("#")?p+t:this.withIdRefPrefix(t)}return r}withIdRefPrefixArray(r){for(let e=0;e<r.length;e++)r[e]=this.withIdRefPrefix(r[e]);return r}isValid(r,e,t){const a=t.$id??p;try{void 0===this.ajv.getSchema(a)&&this.ajv.addSchema(t,a);const o=this.withIdRefPrefix(r);let s;return o.$id&&(s=this.ajv.getSchema(o.$id)),void 0===s&&(s=this.ajv.compile(o)),s(e)}catch(r){return console.warn("Error encountered compiling schema:",r),!1}finally{this.ajv.removeSchema(a)}}withIdRefPrefix(r){return Array.isArray(r)?this.withIdRefPrefixArray([...r]):c.default(r)?this.withIdRefPrefixObject(l.default(r)):r}}function j(r,e){return void 0===r&&(r={}),new y(r,e)}var E=j();r.customizeValidator=j,r.default=E,Object.defineProperty(r,"__esModule",{value:!0})}));
//# sourceMappingURL=validator-ajv8.umd.production.min.js.map
